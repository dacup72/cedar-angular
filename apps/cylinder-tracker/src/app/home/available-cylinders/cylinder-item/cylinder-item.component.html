<div [ngClass]="cylinder.errorList.length ? 'color-bar-error' : (cylinder.state === 'inUse') ? 'color-bar-inUse' : 'color-bar-spare'"></div>
<div
  class="cylinder-item-content"
  (click)="filterOtherCard.emit(cylinder)"
>
  <div class="cylinder-item-id">
    <h2>Cylinder ID: {{ cylinder.cylinderID }}</h2>
    <h3>Expires: {{ parseDate(cylinder.expirationDate) | date }}</h3>
    <h3>Vendor ID: {{ cylinder.vendorID }}</h3>
  </div>

  <div class="cylinder-item-gas-codes">
    <div *ngFor="let gas of this.gasSorter(cylinder.componentGases, 'epaGasCode')" class="gas-code-item mat-elevation-z8">
      <span 
        class="gas-code"
        *ngIf="commonGasTypes.includes(gas.epaGasCode.toUpperCase())"
        [ngStyle]="{
          'background-color': gasColors['$cylindertracker' + gas.epaGasCode.toLowerCase()],
          'color': gasColors['$cylindertracker' + gas.epaGasCode.toLowerCase() + 'text']
        }"
      >{{ gas.epaGasCode }}</span>
      <span 
        *ngIf="commonGasTypes.includes(gas.epaGasCode.toUpperCase())"
        class="gas-concentration"
        [ngStyle]="{
          'background-color': gasColors['$cylindertracker' + gas.epaGasCode.toLowerCase()],
          'color': gasColors['$cylindertracker' + gas.epaGasCode.toLowerCase() + 'text']
        }"
      >{{ gas.gasConcentration }} {{ gas.uom }}</span>
    </div>
  </div>
  <div class="cylinder-item-error-field mat-elevation-z8" *ngIf="cylinder.errorList.length; else noErrors">
    <div *ngFor="let error of cylinder.errorList">- {{error.errorMsg}}</div>
  </div>
  <ng-template #noErrors><div class="no-errors"></div></ng-template>

  <table
    mat-table
    class="cylinder-item-assigned-gases mat-elevation-z8"
    *ngIf="isAssignedCylinder"
    [dataSource]="getGasProfileForID(cylinder.cylinderID)"
  >
    <ng-container matColumnDef="unit">
      <th mat-header-cell *matHeaderCellDef>Unit</th>
      <td mat-cell *matCellDef="let gasProfile" >{{ getUnitName(gasProfile.unit) }}</td>
    </ng-container>

    <ng-container matColumnDef="desc">
      <th mat-header-cell *matHeaderCellDef>Desc</th>
      <td mat-cell *matCellDef="let gasProfile">
        <span class="cyl-unit-desc" *ngFor="let description of gasProfile.desc.split(',')">{{ description }}</span>
      </td>
    </ng-container>

    <tr mat-row *matRowDef="let row; columns: gasProfileCols"></tr>
  </table>

  <!-- <table
  mat-table
  class="cylinder-item-assigned-gases mat-elevation-z8"
  *ngIf="isAssignedCylinder"
  [dataSource]="findAssignedGasProfiles(cylinder)"
>
  <ng-container matColumnDef="unit">
    <th mat-header-cell *matHeaderCellDef>Unit</th>
    <td mat-cell *matCellDef="let gasProfile">Unit: {{ gasProfile.unit }}</td>
  </ng-container>

  <ng-container matColumnDef="desc">
    <th mat-header-cell *matHeaderCellDef>Test</th>
    <td mat-cell *matCellDef="let gasProfile">{{ gasProfile.desc }}</td>
  </ng-container>

  <ng-container matColumnDef="maxValue">
    <th mat-header-cell *matHeaderCellDef>Max Value</th>
    <td mat-cell *matCellDef="let gasProfile">
      {{ gasProfile.allowableGasValueMax }}
    </td>
  </ng-container>

  <ng-container matColumnDef="minValue">
    <th mat-header-cell *matHeaderCellDef>Min Value</th>
    <td mat-cell *matCellDef="let gasProfile">
      {{ gasProfile.allowableGasValueMin }}
    </td>
  </ng-container>

  <tr mat-row *matRowDef="let row; columns: gasProfileCols"></tr>
</table> -->

</div>
<div class="options-menu">
  <button mat-icon-button [matMenuTriggerFor]="cylinderMenu">
    <mat-icon>more_horiz</mat-icon>
  </button>
  <mat-menu #cylinderMenu="matMenu">
    <button
      mat-menu-item
      (click)="editCylinder.emit(cylinder)"
    >
      <mat-icon>edit</mat-icon>
      <span>Edit Cylinder</span>
    </button>
    <button
      mat-menu-item
      (click)="createSimilarCyl.emit(cylinder)"
    >
      <mat-icon>add</mat-icon>
      <span>Create Similar Cylinder</span>
    </button>
    <button
      mat-menu-item
      *ngIf="!isAssignedCylinder"
      (click)="retireCylinder.emit(cylinder)"
    >
      <mat-icon>delete</mat-icon>
      <span>Retire Cylinder</span>
    </button>
  </mat-menu>
</div>
